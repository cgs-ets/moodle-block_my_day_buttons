{"version":3,"sources":["../src/control.js"],"names":["define","$","Log","PubSub","Ajax","LAYOUT","SMALL","FULL","MyDayButtonsControl","region","date","username","instanceid","self","parseInt","data","prototype","main","refreshButtonLayout","removeClass","setupEvents","window","on","subscribe","unbind","navigate","direction","addClass","args","timetableuser","nav","debug","JSON","stringify","call","methodname","done","response","refreshLayout","html","fail","reason","error","layoutWidth","outerWidth","htmlResult","fadeOut","replaceWith","show","init","first","length","control"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Provides the block_my_day_buttons/control module\n *\n * @package   block_my_day_buttons\n * @category  output\n * @copyright 2019 Michael Vangelovski\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\n/**\n * @module block_my_day_buttons/control\n */\ndefine(['jquery', 'core/log', 'core/pubsub', 'core/ajax'], function ($, Log, PubSub, Ajax) {\n    'use strict';\n\n    // Constants.\n    var LAYOUT = {\n        SMALL: 'view-small',\n        FULL: 'view-full',\n    };\n\n    /**\n     * Initializes the block controls.\n     *\n     * @param {int} root The block instance id.\n     */\n    function init(instanceid, date, username) {\n        Log.debug('block_my_day_buttons/control: initializing controls of the my_day_buttons block instance ' + instanceid);\n\n        var region = $('[data-region=\"block_my_day_buttons-instance-' + instanceid + '\"]').first();\n\n        if (!region.length) {\n            Log.debug('block_my_day_buttons/control: wrapping region not found!');\n            return;\n        }\n\n        var control = new MyDayButtonsControl(region, date, username, instanceid);\n        control.main();\n    }\n\n    /**\n     * Controls a single my_day_buttons block instance contents.\n     *\n     * @constructor\n     * @param {jQuery} region\n     */\n    function MyDayButtonsControl(region, date, username, instanceid) {\n        var self = this;\n        self.region = region;\n        self.date = date;\n        self.instanceid = parseInt(instanceid);\n        self.username = region.data(\"timetableuser\");\n    }\n\n    /**\n     * Run the controller.\n     *\n     */\n    MyDayButtonsControl.prototype.main = function () {\n        var self = this;\n\n        // Initialise layout.\n        self.refreshButtonLayout();\n        self.region.removeClass('isloading');\n\n        // Setup nav events\n        self.setupEvents();\n\n        // Watch resize to adjust width.\n        $(window).on('resize', function () {\n            self.refreshButtonLayout();\n        });\n\n        // Subscribe to nav drawer event and resize when it completes.\n        PubSub.subscribe('nav-drawer-toggle-end', function (el) {\n            self.refreshButtonLayout();\n        });\n    };\n\n    MyDayButtonsControl.prototype.setupEvents = function () {\n        var self = this;\n        // Unbind all existing events.\n        $('#inst' + self.instanceid + '.block_my_day_buttons').unbind();\n        \n        // Set up navigation events.\n        $('#inst' + self.instanceid + '.block_my_day_buttons').on('click', '.timetable-prev', function () {\n            self.navigate(0);\n        });\n        $('#inst' + self.instanceid + '.block_my_day_buttons').on('click', '.timetable-next', function () {\n            self.navigate(1);\n        });\n    }\n\n    /**\n     * Navigate to Next day.\n     *\n     * @method\n     */\n    MyDayButtonsControl.prototype.navigate = function (direction) {\n        var self = this;\n        self.region.addClass('fetchingdata');\n        var args = {\n            timetableuser: self.username,\n            nav: direction,\n            date: self.date,\n            instanceid: self.instanceid\n        };\n        Log.debug('block_my_day_buttons/content: Navigate timetable: ' + JSON.stringify(args));\n        Ajax.call([{\n            methodname: 'block_my_day_buttons_get_timetable_html_for_date',\n            args: args,\n            done:function(response) {\n                Log.debug(('Timetable values retrieved successfuly.'));\n                self.refreshLayout(response.html);\n            },\n           fail: function(reason) {\n                Log.error('block_my_day_buttons:navigate: Unable to get timetable.');\n                Log.debug(reason);\n            }\n        }]);\n    };\n\n    /**\n     * Determine period widths.\n     *\n     */\n    MyDayButtonsControl.prototype.refreshButtonLayout = function () {\n        var self = this;\n        var layoutWidth = self.region.outerWidth();\n        Log.debug('Resizing my_day_buttons layout. Width: ' + layoutWidth);\n\n        self.region.removeClass(LAYOUT.SMALL);\n        self.region.removeClass(LAYOUT.FULL);\n\n        if (layoutWidth < 520) {\n            self.region.addClass(LAYOUT.SMALL);\n        } else {\n            self.region.addClass(LAYOUT.FULL);\n        }\n    };\n\n    /**\n     * This refresh is use when navigating the timetable\n     *\n     * @method\n     **/\n    MyDayButtonsControl.prototype.refreshLayout = function(htmlResult){\n        var self = this;\n\n        self.region.fadeOut(300, function() {\n            self.region.replaceWith(htmlResult);\n            self.region.show();\n            self.region = $('[data-region=\"block_my_day_buttons-instance-' + self.instanceid + '\"]');\n            self.date = self.region.data(\"timetabledate\");\n            self.region.removeClass('isloading');\n            self.region.removeClass('fetchingdata');\n            self.refreshButtonLayout();\n        });\n    };\n    return {\n        init: init\n    };\n});"],"file":"control.min.js"}