define ("block_my_day_buttons/control",["jquery","core/log","core/pubsub","core/ajax"],function(a,b,c,d){'use strict';var f={SMALL:"view-small",FULL:"view-full"};function e(a,b,c,d){var e=this;e.region=a;e.date=b;e.instanceid=parseInt(d);e.username=a.data("timetableuser")}e.prototype.main=function(){var b=this;b.refreshButtonLayout();b.region.removeClass("isloading");b.setupEvents();a(window).on("resize",function(){b.refreshButtonLayout()});c.subscribe("nav-drawer-toggle-end",function(){b.refreshButtonLayout()})};e.prototype.setupEvents=function(){var b=this;a("#inst"+b.instanceid+".block_my_day_buttons").unbind();a("#inst"+b.instanceid+".block_my_day_buttons").on("click",".timetable-prev",function(){b.navigate(0)});a("#inst"+b.instanceid+".block_my_day_buttons").on("click",".timetable-next",function(){b.navigate(1)})};e.prototype.navigate=function(a){var c=this;c.region.addClass("fetchingdata");var e={timetableuser:c.username,nav:a,date:c.date,instanceid:c.instanceid};b.debug("block_my_day_buttons/content: Navigate timetable: "+JSON.stringify(e));d.call([{methodname:"block_my_day_buttons_get_timetable_html_for_date",args:e,done:function done(a){b.debug("Timetable values retrieved successfuly.");c.refreshLayout(a.html)},fail:function fail(a){b.error("block_my_day_buttons:navigate: Unable to get timetable.");b.debug(a)}}])};e.prototype.refreshButtonLayout=function(){var a=this,c=a.region.outerWidth();b.debug("Resizing my_day_buttons layout. Width: "+c);a.region.removeClass(f.SMALL);a.region.removeClass(f.FULL);if(520>c){a.region.addClass(f.SMALL)}else{a.region.addClass(f.FULL)}};e.prototype.refreshLayout=function(b){var c=this;c.region.fadeOut(300,function(){c.region.replaceWith(b);c.region.show();c.region=a("[data-region=\"block_my_day_buttons-instance-"+c.instanceid+"\"]");c.date=c.region.data("timetabledate");c.region.removeClass("isloading");c.region.removeClass("fetchingdata");c.refreshButtonLayout()})};return{init:function(c,d,f){b.debug("block_my_day_buttons/control: initializing controls of the my_day_buttons block instance "+c);var g=a("[data-region=\"block_my_day_buttons-instance-"+c+"\"]").first();if(!g.length){b.debug("block_my_day_buttons/control: wrapping region not found!");return}var h=new e(g,d,f,c);h.main()}}});
//# sourceMappingURL=control.min.js.map
